{% extends 'base.html' %}
{% block title %}{{ _('salaries') }}{% endblock %}
{% block content %}
<div class="container mt-4">
    <h2>{{ _('salaries') }}</h2>
    <form method="POST" action="/salaries" class="p-3 bg-light rounded shadow-sm mb-4">
        <div class="row mb-3">
            <div class="col-md-4 mb-2">
                <label for="employeeName" class="form-label">{{ _('name') }}</label>
                <input type="text" id="employeeName" name="name" class="form-control" placeholder="{{ _('name') }}" required>
            </div>
            <div class="col-md-4 mb-2">
                <label for="employeeJobTitle" class="form-label">{{ _('job_title') }}</label>
                <input type="text" id="employeeJobTitle" name="job_title" class="form-control" placeholder="{{ _('job_title') }}" required>
            </div>
            <div class="col-md-4 mb-2">
                <label for="employeeSalary" class="form-label">{{ _('amount') }}</label>
                <input type="number" step="0.01" id="employeeSalary" name="salary_amount" class="form-control" placeholder="{{ _('amount') }}" required>
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-md-4 mb-2">
                <label for="employeeCurrency" class="form-label">{{ _('currency') }}</label>
                <select id="employeeCurrency" name="currency_id" class="form-select" required>
                    {% for currency in currencies %}
                        <option value="{{ currency.id }}">{{ currency.code }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4 mb-2">
                <label for="employeePaymentDate" class="form-label">{{ _('date') }}</label>
                <input type="date" id="employeePaymentDate" name="payment_date" class="form-control" required>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 text-end">
                <button type="submit" class="btn btn-primary px-4">{{ _('add_new') }}</button>
            </div>
        </div>
    </form>
    <hr>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>#</th>
                <th>{{ _('name') }}</th>
                <th>{{ _('job_title') }}</th>
                <th>{{ _('amount') }}</th>
                <th>{{ _('currency') }}</th>
                <th>{{ _('date') }}</th>
                <th>{{ _('actions') }}</th>
            </tr>
        </thead>
        <tbody>
            {% set base_currency = currencies|selectattr('is_base')|first %}
            {% for employee in employees %}
            <tr>
                <td>{{ employee.id }}</td>
                <td>{{ employee.name }}</td>
                <td>{{ employee.job_title }}</td>
                <td>
                  {{ format_currency(employee.salary_amount, employee.currency_id) }}<br>
                  <span class="text-info small">
                    ({{ format_currency(convert_currency(employee.salary_amount, employee.currency_id, base_currency.id), base_currency.id) }})
                  </span>
                </td>
                <td>{{ employee.currency.code }}</td>
                <td>{{ employee.payment_date }}</td>
                <td>
                    <form method="POST" action="/salaries/delete" style="display:inline;">
                        <input type="hidden" name="employee_id" value="{{ employee.id }}">
                        <button type="submit" class="btn btn-danger btn-sm">{{ _('delete') }}</button>
                    </form>
                    <form method="POST" action="/salaries/pay-again" style="display:inline; margin-right: 5px;">
                        <input type="hidden" name="employee_id" value="{{ employee.id }}">
                        <button type="submit" class="btn btn-success btn-sm">تقبيض جديد</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
