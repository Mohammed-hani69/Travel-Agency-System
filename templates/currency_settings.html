{% extends 'base.html' %}
{% block title %}{{ _('currency_settings') }}{% endblock %}
{% block content %}
<div class="container mt-4">
    <h2>{{ _('currency_settings') }}</h2>
    <form id="currencyForm" method="POST" action="/currencies/add" class="p-3 bg-light rounded shadow-sm mb-4">
        <input type="hidden" id="currencyId" name="currency_id">
        <div class="row mb-3">
            <div class="col-md-3 mb-2">
                <label for="currencyCode" class="form-label">{{ _('currency') }} (e.g. USD)</label>
                <input type="text" id="currencyCode" name="code" class="form-control" placeholder="{{ _('currency') }} (e.g. USD)" required>
            </div>
            <div class="col-md-3 mb-2">
                <label for="currencyName" class="form-label">{{ _('name') }}</label>
                <input type="text" id="currencyName" name="name" class="form-control" placeholder="{{ _('name') }}" required>
            </div>
            <div class="col-md-2 mb-2">
                <label for="currencySymbol" class="form-label">رمز العملة (e.g. $)</label>
                <input type="text" id="currencySymbol" name="symbol" class="form-control" placeholder="رمز العملة (e.g. $)" required>
            </div>
            <div class="col-md-2 mb-2">
                <label for="exchangeRate" class="form-label">سعر الصرف</label>
                <input type="number" step="0.01" id="exchangeRate" name="exchange_rate" class="form-control" placeholder="سعر الصرف" required>
            </div>
            <div class="col-md-2 mb-2 d-flex align-items-end">
                <button type="submit" id="submitBtn" class="btn btn-primary w-100">{{ _('add_new') }}</button>
            </div>
        </div>
    </form>
    <hr>
    <h4>{{ _('currency') }} {{ _('settings') }}</h4>
    <form method="POST" action="/currencies/set_base">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>#</th>
                    <th>{{ _('currency') }}</th>
                    <th>{{ _('name') }}</th>
                    <th>رمز</th>
                    <th>سعر الصرف</th>
                    <th>رئيسية؟</th>
                    <th>{{ _('actions') }}</th>
                </tr>
            </thead>
            <tbody>
                {% for currency in currencies %}
                <tr>
                    <td>{{ currency.id }}</td>
                    <td>{{ currency.code }}</td>
                    <td>{{ currency.name }}</td>
                    <td>{{ currency.symbol }}</td>
                    <td>{{ currency.exchange_rate }}</td>
                    <td>
                        <input type="radio" name="base_currency_id" value="{{ currency.id }}" {% if currency.is_base %}checked{% endif %}>
                    </td>
                    <td>
                        <form method="POST" action="/currencies/delete" style="display:inline;">
                            <input type="hidden" name="currency_id" value="{{ currency.id }}">
                            <button type="submit" class="btn btn-danger btn-sm">{{ _('delete') }}</button>
                        </form>
                        <button type="button" class="btn btn-warning btn-sm edit-currency-btn"
                            data-id="{{ currency.id }}"
                            data-code="{{ currency.code }}"
                            data-name="{{ currency.name }}"
                            data-symbol="{{ currency.symbol }}"
                            data-exchange_rate="{{ currency.exchange_rate }}">
                            {{ _('edit') }}
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <button type="submit" class="btn btn-success">تعيين العملة الرئيسية</button>
    </form>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// عند الضغط على زر تعديل، يتم تعبئة بيانات العملة في فورم الإضافة
const editBtns = document.querySelectorAll('.edit-currency-btn');
const form = document.getElementById('currencyForm');
const submitBtn = document.getElementById('submitBtn');
editBtns.forEach(btn => {
    btn.addEventListener('click', function() {
        document.getElementById('currencyId').value = this.dataset.id;
        document.getElementById('currencyCode').value = this.dataset.code;
        document.getElementById('currencyName').value = this.dataset.name;
        document.getElementById('currencySymbol').value = this.dataset.symbol;
        document.getElementById('exchangeRate').value = this.dataset.exchange_rate;
        form.action = '/currencies/edit';
        submitBtn.textContent = '{{ _('save') }}';
        submitBtn.classList.remove('btn-primary');
        submitBtn.classList.add('btn-success');
    });
});
// عند إعادة تحميل الصفحة أو الضغط على إضافة جديد، يرجع الفورم لوضع الإضافة
form.addEventListener('reset', function() {
    form.action = '/currencies/add';
    submitBtn.textContent = '{{ _('add_new') }}';
    submitBtn.classList.remove('btn-success');
    submitBtn.classList.add('btn-primary');
});
</script>
{% endblock %}
