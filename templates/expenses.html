{% extends 'base.html' %}
{% block title %}{% if get_locale() == 'ar' %}المصروفات{% else %}Expenses{% endif %}{% endblock %}
{% block content %}
<div class="container mt-4">
    <h2>{% if get_locale() == 'ar' %}المصروفات{% else %}Expenses{% endif %}</h2>
    <div class="row mb-3">
        <div class="col-md-6">
            <div style="background-color: #dc3545; color: #fff; border-radius: 8px; padding: 16px; box-shadow: 0 2px 6px #0001;">
                <strong>{% if get_locale() == 'ar' %}إجمالي المصروفات:{% else %}Total Expenses:{% endif %}</strong>
                {{ format_currency(expenses|map(attribute='amount_' ~ base_currency.code.lower())|sum, base_currency.id) }}
            </div>
        </div>
    </div>
    <form method="POST" action="/expenses" class="p-3 bg-light rounded shadow-sm mb-4">
        <div class="row mb-3">
            <div class="col-md-6 mb-2">
                <label for="expenseName" class="form-label">{% if get_locale() == 'ar' %}الاسم{% else %}Name{% endif %}</label>
                <input type="text" id="expenseName" name="name" class="form-control" placeholder="{% if get_locale() == 'ar' %}الاسم{% else %}Name{% endif %}" required>
            </div>
            <div class="col-md-3 mb-2">
                <label for="expenseAmount" class="form-label">{% if get_locale() == 'ar' %}المبلغ{% else %}Amount{% endif %}</label>
                <input type="number" step="0.01" id="expenseAmount" name="amount" class="form-control" placeholder="{% if get_locale() == 'ar' %}المبلغ{% else %}Amount{% endif %}" required>
            </div>
            <div class="col-md-3 mb-2">
                <label for="expenseCurrency" class="form-label">{% if get_locale() == 'ar' %}العملة{% else %}Currency{% endif %}</label>
                <select id="expenseCurrency" name="currency_id" class="form-select" required>
                    {% for currency in currencies %}
                        <option value="{{ currency.id }}">{{ currency.code }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-md-4 mb-2">
                <label for="expenseDate" class="form-label">{% if get_locale() == 'ar' %}التاريخ{% else %}Date{% endif %}</label>
                <input type="date" id="expenseDate" name="date" class="form-control" required>
            </div>
            <div class="col-md-4 mb-2">
                <label for="expenseMonthYear" class="form-label">{% if get_locale() == 'ar' %}الشهر{% else %}Month{% endif %}</label>
                <input type="text" id="expenseMonthYear" name="month_year" class="form-control" placeholder="YYYY-MM" required>
            </div>
            <div class="col-md-4 mb-2">
                <label for="expenseNotes" class="form-label">{% if get_locale() == 'ar' %}ملاحظات{% else %}Notes{% endif %}</label>
                <input type="text" id="expenseNotes" name="notes" class="form-control" placeholder="{% if get_locale() == 'ar' %}ملاحظات{% else %}Notes{% endif %}">
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 text-end">
                <button type="submit" class="btn btn-primary px-4">{% if get_locale() == 'ar' %}إضافة جديد{% else %}Add New{% endif %}</button>
            </div>
        </div>
    </form>
    <hr>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>#</th>
                <th>{% if get_locale() == 'ar' %}الاسم{% else %}Name{% endif %}</th>
                <th>{% if get_locale() == 'ar' %}المبلغ{% else %}Amount{% endif %}</th>
                <th>{% if get_locale() == 'ar' %}العملة{% else %}Currency{% endif %}</th>
                <th>{% if get_locale() == 'ar' %}التاريخ{% else %}Date{% endif %}</th>
                <th>{% if get_locale() == 'ar' %}ملاحظات{% else %}Notes{% endif %}</th>
                <th>{% if get_locale() == 'ar' %}الإجراءات{% else %}Actions{% endif %}</th>
            </tr>
        </thead>
        <tbody>
            {% set base_currency = currencies|selectattr('is_base')|first %}
            {% set currency_code = base_currency.code.lower() %}
            {% for expense in expenses %}
            <tr>
                <td>{{ expense.id }}</td>
                <td>{{ expense.name }}</td>
                <td>
                  {{ format_currency(attribute(expense, 'amount_' ~ currency_code), base_currency.id) }}
                </td>
                <td>{{ base_currency.code }}</td>
                <td>{{ expense.date }}</td>
                <td>{{ expense.notes }}</td>
                <td>
                    <form method="POST" action="/expenses/delete" style="display:inline;">
                        <input type="hidden" name="expense_id" value="{{ expense.id }}">
                        <button type="submit" class="btn btn-danger btn-sm">{% if get_locale() == 'ar' %}حذف{% else %}Delete{% endif %}</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
